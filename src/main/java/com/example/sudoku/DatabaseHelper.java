package com.example.sudoku;

import java.sql.*;

public class DatabaseHelper {

    private static final String DB_URL = "jdbc:sqlite:C:/Sudoku/sudoku.db";

    static {
        try (Connection conn = DriverManager.getConnection(DB_URL);
             Statement st = conn.createStatement()) {

            st.execute("DROP TABLE IF EXISTS sudoku_puzzles");
            st.execute("""
               CREATE TABLE IF NOT EXISTS sudoku_puzzles (
                   id INTEGER PRIMARY KEY AUTOINCREMENT,
                   puzzle TEXT NOT NULL,
                   difficulty TEXT NOT NULL
               )
            """);

            ResultSet rs = st.executeQuery("SELECT COUNT(*) FROM sudoku_puzzles");
            if (rs.next() && rs.getInt(1) == 0) {
                st.execute("""
                   INSERT INTO sudoku_puzzles (puzzle, difficulty) VALUES
                   ('530070000600195000098000060800060003400803001700020006060000280000419005000080079', 'EASY'),
                   ('000260701680070090190004500820100040004602900050003028009300074040050036703018000', 'EASY'),
                   ('302609005000000300000003010700000006060708020900000001090500000004000000800402107', 'EASY'),
                   ('200080300060070084030500209000105408000000000402706000301007040720040060004010003', 'EASY'),
                   ('000000907000420180000705026100904000050000040000507009920108000034059000507000000', 'EASY'),
                   ('050807020600010090702540006070020301504000908103080070900075604060090002080406050', 'EASY'),
                   ('000900800128006400070800060800430007500000009600079008090005010003600284005004000', 'EASY'),
                   ('300000000005009000200504000020000700160000058704310600000890100000067080000005437', 'EASY'),
                   ('006100720000050004000003060007000080010708050080000600030500000100060000040000100', 'MEDIUM'),                                                                                                              
                   ('000907000007000800000000000030040020050600040060010030000000000009000100000103000', 'MEDIUM'),
                   ('300200000000107000706030500070009080900020004010800050009040301000702000000008006', 'MEDIUM'),
                   ('004000700200601000070000020008002030000050000060300800050000040000704001007000600', 'MEDIUM'),
                   ('000503000000070200010000050006000040500804007070000800090000030003010000000706000', 'MEDIUM'),
                   ('000260701680070090190004500820100040004602900050003028009300074040050036703018000', 'MEDIUM'),
                   ('100007090030020008009600500005300900010080002600004000300000010040000007007000300', 'MEDIUM'),
                   ('000900002003000400050001000100400000000000000000007010006700050020000100900008000', 'MEDIUM'),
                   ('000000907000420180000705026100904000050000040000507009920108000034059000506000000', 'HARD'),
                   ('030050040008010500460000012070502080000603000040109030250000098001020600080060000', 'HARD'),
                   ('568000402100000638040080050000026394473891205000345000600009100034100000009530040', 'HARD'),
                   ('100920000524010000000000070050008102000000000402700090060000000000030945000071006', 'HARD'),
                   ('005300000800000020070010500400005300010070006003200080060500009004000030000009700', 'HARD'),
                   ('000900002400000600001080000020040000500100007000070030000060900006000004200003000', 'HARD'),
                   ('000900800128000000070060000050007000000504000000300020000010070000000309006005000', 'HARD'),
                   ('009000000000002310600001000000007040000000000007000000500700002004100000000000900', 'HARD');
               """);

            }

        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public static int[][] getRandomPuzzle(Difficulty difficulty) {
        int[][] board = new int[9][9];
        String puzzle = null;

        String sql = " SELECT puzzle FROM sudoku_puzzles WHERE difficulty=? ORDER BY RANDOM() LIMIT 1";

        try (Connection conn = DriverManager.getConnection(DB_URL);
             PreparedStatement st = conn.prepareStatement(sql)){
             st.setString(1, difficulty.name());
             ResultSet rs = st.executeQuery();

            if (rs.next()) puzzle = rs.getString("puzzle");

        } catch (SQLException e) {
            e.printStackTrace();
        }

        if (puzzle == null) {
            puzzle = "530070000600195000098000060800060003400803001700020006060000280000419005000080079";
        }

        int k = 0;
        for (int r = 0; r < 9; r++)
            for (int c = 0; c < 9; c++)
                board[r][c] = puzzle.charAt(k++) - '0';

        return board;
    }
}
