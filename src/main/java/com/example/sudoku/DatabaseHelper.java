package com.example.sudoku;

import java.sql.*;

public class DatabaseHelper {

    private static final String DB_URL = "jdbc:sqlite:C:/Sudoku/sudoku.db";

    static {
        try (Connection conn = DriverManager.getConnection(DB_URL);
             Statement st = conn.createStatement()) {

            st.execute("DROP TABLE IF EXISTS sudoku_puzzles");
            st.execute("""
               CREATE TABLE IF NOT EXISTS sudoku_puzzles (
                   id INTEGER PRIMARY KEY AUTOINCREMENT,
                   puzzle TEXT NOT NULL,
                   difficulty TEXT NOT NULL
               )
            """);

            ResultSet rs = st.executeQuery("SELECT COUNT(*) FROM sudoku_puzzles");
            if (rs.next() && rs.getInt(1) == 0) {
                st.execute("""
                   INSERT INTO sudoku_puzzles (puzzle, difficulty) VALUES
                   ('207300000096702008005009020050020700080060030002030040070200800600803250000005409', 'EASY'),
                   ('005083042009500070043000900004002090510809037070400200007000310050004700380690500', 'EASY'),
                   ('903008400050107003687302900000600000538200000102004090300906070726851040000403250', 'EASY'),
                   ('006871003073056190000349027342000080060020000000003052010704800700598261005000900', 'EASY'),
                   ('060080002410060087000074510000001900000820631801049070007090020280053009096218050', 'EASY'),
                   ('900006503005000060086300000000039710200504006031820000000002430060000100109400008', 'EASY'),
                   ('600801750070549010003602080200306040060150000035084600006410000058000920007900165', 'EASY'),
                   ('803100000015402009002005070030040500040090020007050010050800100200507980000004705', 'EASY'),
                   ('906000040000970500000004019000050163600000008152030000370400000005098000010000605', 'MEDIUM'),                                                                                                              
                   ('060500940000094080004102000000009500087405360009700000000307600090240000072008010', 'MEDIUM'),
                   ('000300056087005900532700000000000061074000380960000000000003197001200640340001000', 'MEDIUM'),
                   ('963804270240905813000307006720680000000200001305040080000400520602000104050030000', 'MEDIUM'),
                   ('605189024010000086382405097043051000507000040000700800030000050200078400000506210', 'MEDIUM'),
                   ('501072000609000000807540603496007800003004006210090040060000008005063429004028561', 'MEDIUM'),
                   ('000003002006710309200840070003000800802030401004000900040069005105087600900100000', 'MEDIUM'),
                   ('000000000540070001600450200068520309020000040705094620001089004300010072000000000', 'MEDIUM'),
                   ('000000000000060003010009207030084071060000900047000008500800130000640500326050000', 'HARD'),
                   ('000400060068307500009000003001083000800602009000750300700000200003206810080001000', 'HARD'),
                   ('568000402100000638040080050000026394473891205000345000600009100034100000009530040', 'HARD'),
                   ('000003570002007000005000600000060290006000000031800000700900040004001080060000910', 'HARD'),
                   ('013900075020005900000700001000000800360010000000007009401060300700580002002473506', 'HARD'),
                   ('200405030500090640000000508070020300000914006000600000980006000600080201020000000', 'HARD'),
                   ('085906004000008000000750030608000072007803400930000806050047000000600000100305620', 'HARD'),
                   ('080000704100000085000030200402910008900007340000000097000706001007040906205800003', 'HARD');
               """);

            }

        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public static int[][] getRandomPuzzle(Difficulty difficulty) {
        int[][] board = new int[9][9];
        String puzzle = null;

        String sql = " SELECT puzzle FROM sudoku_puzzles WHERE difficulty=? ORDER BY RANDOM() LIMIT 1";

        try (Connection conn = DriverManager.getConnection(DB_URL);
             PreparedStatement st = conn.prepareStatement(sql)){
             st.setString(1, difficulty.name());
             ResultSet rs = st.executeQuery();

            if (rs.next()) puzzle = rs.getString("puzzle");

        } catch (SQLException e) {
            e.printStackTrace();
        }

        if (puzzle == null) {
            puzzle = "530070000600195000098000060800060003400803001700020006060000280000419005000080079";
        }

        int k = 0;
        for (int r = 0; r < 9; r++)
            for (int c = 0; c < 9; c++)
                board[r][c] = puzzle.charAt(k++) - '0';

        return board;
    }
}
